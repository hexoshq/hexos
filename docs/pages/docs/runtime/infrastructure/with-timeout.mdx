---
title: "WithTimeout"
generated: true
---

import { GenerationInfo } from '@/docs/components/docs/GenerationInfo'
import { MemberInfo } from '@/docs/components/docs/MemberInfo'

<GenerationInfo sourceFile="packages/runtime/src/utils/timeout.ts" sourceLine="38" packageName="@hexos/runtime" />

Wraps an async operation with a timeout, rejecting with [TimeoutError](/docs/runtime/infrastructure/timeout-error#timeouterror) if it exceeds the limit.

Accepts either a Promise or a factory function that returns a Promise. The timer is cleaned up
on both success and failure to prevent memory leaks. Used throughout [AgentRuntime](/docs/runtime/agent-runtime/#agentruntime) for
tool execution timeouts, approval wait timeouts, and MCP request timeouts.

```ts
function withTimeout<T>(operation: Promise<T> | (() => Promise<T>), timeoutMs: number, timeoutMessage: string, timeoutCode:  = 'TIMEOUT'): Promise<T>
```
Parameters

### operation

<MemberInfo kind="parameter" type={`Promise<T> | (() => Promise<T>)`} />

### timeoutMs

<MemberInfo kind="parameter" type={`number`} />

### timeoutMessage

<MemberInfo kind="parameter" type={`string`} />

### timeoutCode

<MemberInfo kind="parameter" type={``} />

