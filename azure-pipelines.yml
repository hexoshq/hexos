trigger: none
pr: none

pool:
  vmImage: ubuntu-latest

steps:
  - checkout: self
    fetchDepth: "0"

  - task: NodeTool@0
    displayName: "Use Node.js 20"
    inputs:
      versionSpec: "20.x"

  - script: |
      corepack enable
      corepack prepare pnpm@9.15.0 --activate
      pnpm --version
    displayName: "Enable pnpm via Corepack"

  - script: |
      pnpm install --frozen-lockfile
    displayName: "Install dependencies"

  - script: |
      pnpm run build:libs
    displayName: "Build packages (Lerna)"

  - task: npmAuthenticate@0
    displayName: "Authenticate to Azure Artifacts"
    inputs:
      workingFile: "$(Build.SourcesDirectory)/.npmrc"

  - script: |
      pnpm run publish:libs
    displayName: "Publish packages to Azure Artifacts (Lerna)"
